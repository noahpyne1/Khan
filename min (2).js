window.exp=window.exp||{Overwrite:{enabled:!0,automate:!1,delay:0.3},showAnswer:!1,videoSpoof:!0,stopTimer:!0,rgb:!1};class Tools{static log(e,t,o){console.log(`%c${e}:`,`color: ${t}; font-weight: bold;`,o)}static dupCont(){const e=document.querySelector("._13hsycvc");return e&&"true"!==e.dataset.dup?(e.innerHTML+=e.innerHTML,e.dataset.dup="true",e):null}static setTitle(e,t="Platform Destroyer"){const o=e.querySelector("._pcmek8q");o&&(o.textContent=t)}static setFooter(e,t){const o=e.querySelector("._1ee8w3sd");o&&(o.textContent=t)}static save(){localStorage.setItem("platformDestroyerSettings",JSON.stringify(window.exp))}static toggle(e){const t=e.split(".");let o=window;for(let e=0;e<t.length-1;e++)if(o=o?.[t[e]],!o)return;const n=t.at(-1);if("boolean"!=typeof o[n])return;const r=o[n];o[n]=!r,this.save(),this.update(),"exp.Overwrite.automate"!==e&&"exp.rgb"!==e&&(r||setTimeout(this.reload,150))}static update(){["exp.Overwrite.enabled","exp.Overwrite.automate","exp.showAnswer","exp.videoSpoof","exp.stopTimer","exp.rgb"].forEach((e=>{const t=e.replace(/\./g,"-")+"-btn",o=document.getElementById(t);if(!o)return;let n=window;for(const t of e.split("."))n=n?.[t];const r=n?"rgb(144, 238, 144)":"rgb(255, 182, 193)",a=o.querySelector("a");a&&(a.style.backgroundColor=r)}))}static reload(){const e=document.documentElement.outerHTML;console.clear(),document.open(),document.write(`<!DOCTYPE html><html lang="en">${e}</html>\n        <script>\n          (function(){\n            const iv = setInterval(() => {\n              if (window.JSON?.parse?._hooked) {\n                clearInterval(iv);\n                if (typeof init === 'function') init();\n              }\n            }, 200);\n          })();\n        <\/script>`),document.close(),window._menuReady=!1}}try{const e=localStorage.getItem("platformDestroyerSettings");if(e){const t=JSON.parse(e);t&&"object"==typeof t&&(window.exp={...window.exp,...t})}}catch{console.warn("Failed to load saved settings")}if(!JSON.parse._hooked){const e=JSON.parse;JSON.parse=function(t){const o=e(t),n=o?.data;if(n?.user?.contentItemProgresses&&(window._menuReady=!0,setTimeout((()=>{"function"==typeof init&&init()}),100)),n?.assessmentItem?.item?.itemData&&n.assessmentItem.item.itemData.includes("â˜ƒ")){Tools.log("Lesson Data","purple",n.assessmentItem.item.itemData);const parsed=e(n.assessmentItem.item.itemData);try{\n      // Try to detect original widget choices and whether it's a multi-select\n      const origWidgets = parsed.question?.widgets||{};\n      let originalChoices = null;\n      for(const k in origWidgets){\n        const w = origWidgets[k];\n        if(w && w.options && Array.isArray(w.options.choices)){\n          originalChoices = w.options.choices.map(c=>{\n            if(null==c) return {content:'', correct:!1};\n            if('string'==typeof c) return {content:c, correct:!1};\n            return {content:(c.content||c), correct:!!c.correct};\n          });\n          break;\n        }\n      }\n      // Detect multi-select (checkbox) heuristics\n      let isMulti = !1;\n      for(const k in origWidgets){\n        const w = origWidgets[k];\n        if(w && (w.type==='checkbox' || (w.options && w.options.multipleSelect===!0) || /checkbox/i.test(k))){ isMulti = !0; break; }\n      }\n      if(!isMulti && parsed.question?.content && /\\[\\[â˜ƒ\\s*checkbox/i.test(parsed.question.content)) isMulti = !0;\n\n      if(exp.Overwrite.enabled){\n        const prompt = location.hostname.startsWith(\"pt\") ? (isMulti?\"Selecione todas as opÃ§Ãµes corretas\":\"Selecione uma opÃ§Ã£o\") : (isMulti?\"Select all correct options\":\"Select an option\");\n        const widgetKey = isMulti?\"checkbox 1\":\"radio 1\";\n        parsed.question.content = prompt+\"\\n\\n[[â˜ƒ \"+widgetKey+\"]]\";\n\n        // Build choices: prefer original choices if present; append marker to correct ones so the UI automation can find them\n        let choices;\n        if(originalChoices && originalChoices.length){\n          choices = originalChoices.map(c=>({\n            content: String(c.content) + (c.correct ? (location.hostname.startsWith(\"pt\")?\" (Correcto)\":\" (Correct)\") : \"\"),\n            correct: !!c.correct\n          }));\n        }else{\n          choices = [\n            {content: location.hostname.startsWith(\"pt\")?\"Correcto\":\"Correct\", correct:!0},\n            {content: location.hostname.startsWith(\"pt\")?\"Incorrecto\":\"Incorrect\", correct:!1}\n          ];\n        }\n\n        parsed.question.widgets = parsed.question.widgets || {};\n        parsed.question.widgets[widgetKey] = {type: isMulti?\"checkbox\":\"radio\", options:{choices: choices, randomize: !1}, version:{major:1, minor:0}};\n      }\n\n      if(exp.showAnswer){\n        const hint = parsed.hints?.at(-1)?.content ?? \"No hint available.\";\n        parsed.question.content += \"\\n\\n[[â˜ƒ explanation 1]]\";\n        parsed.question.widgets = parsed.question.widgets||{};\n        parsed.question.widgets[\"explanation 1\"] = {type:\"explanation\", options:{explanation:hint, hidePrompt:\"x\", showPrompt:\"Answer\"}, version:{major:0, minor:0}};\n      }\n\n      n.assessmentItem.item.itemData = JSON.stringify(parsed);\n    }catch(err){\n      Tools.log('Overwrite Error','red',err);\n    }}return o}}window._origFetch||(window._origFetch=window.fetch,window.fetch=async(e,t={})=>{let o=e instanceof Request?await e.clone().text():t.body;if(exp.videoSpoof&&o?.includes('\"operationName\":\"updateUserVideoProgress\"'))try{const n=JSON.parse(o),r=n?.variables?.input?.durationSeconds;r&&(n.variables.input.secondsWatched=r,n.variables.input.lastSecondWatched=r,t.body=JSON.stringify(n),e instanceof Request&&(e=new Request(e,{body:t.body})))}catch{}return exp.stopTimer&&\"object\"==typeof e&&e.url?.includes(\"mark_conversions\")&&o?.includes(\"termination_event\")?new Promise((()=>{})):window._origFetch.call(this,e,t)});const sels=['[data-testid=\"choice-icon__library-choice-icon\"]','[data-testid=\"exercise-check-answer\"]','[data-testid=\"exercise-next-question\"]','._1udzurba','._awve9b','._hxicrxf','._ypgawqo'];function getMenu(){const e=document.querySelector(\"._13hsycvc[data-dup='true']\")||Tools.dupCont();return e&&(Tools.setTitle(e,\"ðŸ§  Platform Destroyer\"),Tools.setFooter(e,\"Â© 2025 ilyTobias\")),e}function btn(e,t,o=!1,n=!1){const r=o?\"rgb(144,238,144)\":\"rgb(255,182,193)\",a=n?\"12px\":\"16px\",s=n?\"4px 8px\":\"8px 12px\",i=`<li id=\"${t}-btn\" style=\"margin-bottom:6px; list-style:none;\">\\n    <a href=\"javascript:void(0)\" class=\"_pkhvgz8\" data-path=\"${t.replace(/-/g,\".\")}\" style=\"display:flex; align-items:center; background-color:${r}; font-size:${a}; padding:${s}; cursor:pointer; user-select:none; text-decoration:none; color:#21242c;\">\\n      <span>${e}</span>\\n    </a>\\n  </li>`,c=document.querySelector('[data-testid=\"learnable-content-cells\"]');c&&c.insertAdjacentHTML(\"beforeend\",i)}function delayInput(e){const t=document.querySelector('[data-testid=\"learnable-content-cells\"]');if(!t)return;document.getElementById(\"auto-delay\")?.remove();const o=document.createElement(\"li\");o.id=\"auto-delay\",o.style.cssText=\"margin-bottom:6px; list-style:none; background:#fff; border-radius:4px; padding:6px 12px; display:flex; align-items:center; gap:8px; box-shadow:0 1px 3px rgb(0 0 0 / 0.1);\",o.innerHTML=`<label for=\"delayInput\" style=\"font-size:14px; color:#21242c; user-select:none; flex-grow:1; cursor:pointer;\">Delay (s):</label>\\n    <input id=\"delayInput\" type=\"number\" min=\"0.1\" step=\"0.1\" value=\"${e}\" placeholder=\"Delay (4s)\" style=\"width:70px; padding:4px 8px; font-size:14px; border:1px solid #ccc; border-radius:4px; box-sizing:border-box;\" />`;const n=document.getElementById(\"exp-Overwrite-automate-btn\");n?n.insertAdjacentElement(\"afterend\",o):t.appendChild(o),o.querySelector(\"input\").addEventListener(\"input\",(e=>{const t=parseFloat(e.target.value);if(!isNaN(t)&&t>=0.1&&(exp.Overwrite.delay=t,Tools.save()),t<0.1){} }))}function addRgbCss(){if(document.getElementById(\"rgb-style\"))return;const e=document.createElement(\"style\");e.id=\"rgb-style\",e.textContent=\"@keyframes rgbCycle{0%{filter:hue-rotate(0deg);}100%{filter:hue-rotate(360deg);}}.rgb-anim{animation:rgbCycle 10s linear infinite;}\",document.head.appendChild(e)}function toggleRgb(e){addRgbCss();const t=document.getElementById(\"content-library-content-title\"),o=document.querySelector('path[d=\"M2.31,5.8A3.56,3.56,0,0,0,.66,8.6V19.4a3.56,3.56,0,0,0,1.65,2.8L12,27.62a3.75,3.75,0,0,0,3.3,0L25,22.2a3.56,3.56,0,0,0,1.65-2.8V8.6A3.56,3.56,0,0,0,25,5.8L15.31.38a3.75,3.75,0,0,0-3.3,0Z\"]'),n=document.getElementById(\"top-header-container\");e?(t?.classList.add(\"rgb-anim\"),o&&(o.style.filter=\"hue-rotate(0deg)\"),n?.classList.add(\"rgb-anim\")):(t?.classList.remove(\"rgb-anim\"),o&&(o.style.filter=\"\"),n?.classList.remove(\"rgb-anim\"))}function buildUI(){const e=document.querySelector('[data-testid=\"learnable-content-cells\"]');if(!e)return setTimeout(buildUI,250);e.innerHTML=\"\";const t=(e,t)=>location.hostname.startsWith(\"pt\")?e:t;[{text:t(\"Sobrescrever\",\"Overwrite\"),path:\"exp.Overwrite.enabled\"},{text:t(\"Automatizar\",\"Automate\"),path:\"exp.Overwrite.automate\",small:!0},{text:t(\"Mostrar Resposta\",\"Show Answer\"),path:\"exp.showAnswer\"},{text:t(\"Falso VÃ­deo\",\"Video Spoof\"),path:\"exp.videoSpoof\"},{text:t(\"Parar Temporizador\",\"Stop Timer\"),path:\"exp.stopTimer\"},{text:t(\"RGB\",\"RGB\"),path:\"exp.rgb\"}].forEach((({text:e,path:t,small:o})=>{let n=window;for(const e of t.split(\".\"))n=n?.[e];btn(e,t.replace(/\\./g,\"-\"),!0===n,o),\"exp.Overwrite.automate\"===t&&setTimeout((()=>delayInput(exp.Overwrite.delay)),10)})),e.querySelectorAll(\"li > a\").forEach((e=>{e.addEventListener(\"click\",(()=>{Tools.toggle(e.dataset.path),\"exp.rgb\"===e.dataset.path&&toggleRgb(exp.rgb)}))})),Tools.update(),exp.rgb&&toggleRgb(!0)}function refreshFooter(){document.querySelector(\"._1e104hfr\")?.remove(),document.querySelector(\"._1mzlqz11\")?.remove();const e=document.querySelector(\"._1fzkfbec\");if(!e)return setTimeout(refreshFooter,250);e.innerHTML='\\n    <a class=\"_1w88iq7y\" href=\"https://github.com/ilytobias/Khan-Destroyer\" target=\"_blank\">Github</a>\\n    <a class=\"_1w88iq7y\" href=\"https://discord.gg/platformdestroyer\" target=\"_blank\">Discord</a>'}function init(){const e=document.querySelector(\"._13hsycvc\"),t=document.querySelector(\"._1fzkfbec\"),o=document.querySelector('[data-testid=\"learnable-content-cells\"]');if(!e||!t||!o)return setTimeout(init,250);getMenu(),buildUI(),refreshFooter(),addRgbCss(),exp.rgb&&toggleRgb(!0)}setInterval((()=>{if(exp?.Overwrite?.automate){\n  // Try to click elements that include the (Correct) marker we appended when overwriting choices.\n  const correctLabels = [location.hostname.startsWith(\"pt\")?\"Correcto\":\"Correct\",\"(Correct)\",\"(Correcto)\"];\n  const choiceSelectors = ['[data-testid=\"choice-icon__library-choice-icon\"]','._1udzurba','._awve9b','._hxicrxf','._ypgawqo','[data-testid=\"exercise-choice\"]','[role=\"button\"]'];\n  let clickedAny = !1;\n  try{\n    for(const sel of choiceSelectors){\n      const nodes = Array.from(document.querySelectorAll(sel));\n      for(const node of nodes){\n        const txt = (node.innerText||node.textContent||\"\").trim();\n        for(const lab of correctLabels) if(lab && txt.includes(lab)){ try{ node.click(); clickedAny = !0; }catch{} }\n      }\n    }\n  }catch(e){/* ignore DOM errors */}\n  if(clickedAny){\n    document.querySelector('[data-testid=\"exercise-check-answer\"]')?.click();\n    setTimeout(()=>document.querySelector('[data-testid=\"exercise-next-question\"]')?.click(),150);\n  }else{\n    // fallback: click the default selectors (older behavior)\n    const selsFallback=['[data-testid=\"choice-icon__library-choice-icon\"]','[data-testid=\"exercise-check-answer\"]','[data-testid=\"exercise-next-question\"]','._1udzurba','._awve9b','._hxicrxf','._ypgawqo'];\n    selsFallback.forEach(s=>document.querySelector(s)?.click());\n  }\n}},1e3*(exp?.Overwrite?.delay||1))),Tools.reload(),init();\n